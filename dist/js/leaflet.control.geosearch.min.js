(function(){var g=function(d,a){return function(){return d.apply(a,arguments)}},h={}.hasOwnProperty,k=function(d,a){function b(){this.constructor=d}for(var e in a)h.call(a,e)&&(d[e]=a[e]);b.prototype=a.prototype;d.prototype=new b;d.__super__=a.prototype;return d};L.GeoSearch={};L.GeoSearch.Provider={};jQuery.support.cors=!0;L.GeoSearch.Result=function(d,a,b){this.X=d;this.Y=a;return this.Label=b};L.Control.GeoSearch=function(d){function a(b){this._show=g(this._show,this);this._showLocation=g(this._showLocation,
this);var e=this;L.Util.extend(this.options,b);this.options.onMakeSuggestionHTML=function(b){return e._htmlEscape(b.Label)}}k(a,d);a.prototype.options={position:"topleft",provider:null,searchLabel:"Enter address",notFoundMessage:"Sorry, that address could not be found.",zoomLevel:17,showMarker:!0,enableAutocomplete:!0,autocompleteMinQueryLen:3,autocompleteQueryDelay_ms:800,maxResultCount:10,open:!1};a.prototype.onAdd=function(b){var e,a,f=this;this._container=L.DomUtil.create("div","leaflet-bar leaflet-control leaflet-control-geosearch");
this._btnSearch=L.DomUtil.create("a","",this._container);this._btnSearch.href="#";this._btnSearch.title=this.options.searchLabel;this._changeIcon("glass");e=L.DomUtil.create("form","displayNone",this._container);e.setAttribute("autocomplete","off");a=L.DomUtil.create("input",null,e);a.placeholder=this.options.searchLabel;a.setAttribute("id","inputGeosearch");a.setAttribute("autocomplete","off");this._searchInput=a;b=this.options.open?this._container:this._btnSearch;L.DomEvent.on(b,"click",L.DomEvent.stop).on(b,
"click",function(){if(L.DomUtil.hasClass(e,"displayNone"))return L.DomUtil.removeClass(e,"displayNone"),$(a).select(),$(a).focus(),$(a).trigger("click");if(!f.options.open)return f._hide()});L.DomEvent.on(a,"keyup",this._onKeyUp,this).on(a,"keypress",this._onKeyPress,this).on(a,"input",this._onInput,this);if(L.Browser.touch)L.DomEvent.on(this._container,"click",L.DomEvent.stop);else L.DomEvent.disableClickPropagation(this._container),L.DomEvent.on(this._container,"mousewheel",L.DomEvent.stop);this.options.enableAutocomplete&&
(this._createSuggestionBox(this.container,"leaflet-geosearch-autocomplete"),this._recordLastUserInput(""),$(this._container).append(this._suggestionBox));this._message=L.DomUtil.create("div","leaflet-bar leaflet-geosearch-message displayNone",this._container);L.DomEvent.on(this._map,"click",function(){return f._hide()});return this._container};a.prototype._createSuggestionBox=function(b,a){var c=this;this._suggestionBox=L.DomUtil.create("div",a,b);L.DomUtil.addClass(this._suggestionBox,"displayNone");
L.DomEvent.disableClickPropagation(this._suggestionBox).on(this._suggestionBox,"blur",this._hide,this).on(this._suggestionBox,"mousewheel",function(b){L.DomEvent.stopPropagation(b);if(b.axis===b.VERTICAL_AXIS)return 0<b.detail?c._moveDown():c._moveUp()});return this._suggestionBox};a.prototype._changeIcon=function(b){this._btnSearch=this._container.querySelector("a");return this._btnSearch.className="leaflet-bar-part leaflet-bar-part-single leaflet-geosearch-"+b};a.prototype._geosearch=function(b){var a,
c,f,d=this;try{a=this.options.provider;if("function"===typeof a.GetLocations)return c=a.GetLocations(b,function(b){return d._processResults(b)});f=a.GetServiceUrl(b);return $.getJSON(f,function(b){try{return c=a.ParseJSON(b),d._processResults(c)}catch(f){return d._printError(f)}})}catch(g){return this._printError(g)}};a.prototype._geosearchAutocomplete=function(b,a){var c=this;if(this.options.enableAutocomplete)return clearTimeout(this._autocompleteRequestTimer),this._autocompleteRequestTimer=setTimeout(function(){var a;
a=b;"function"===typeof b&&(a=b());return a.length>=c.options.autocompleteMinQueryLen?c._geosearch(a):c._hide()},a)};a.prototype._processResults=function(b){0===b.length?this._printError(this.options.notFoundMessage):(this._show(b),this._map.fireEvent("geosearch_foundlocations",{Location:location}));return b};a.prototype._showLocation=function(b){b=b[0];this.options.showMarker&&("undefined"===typeof this._positionMarker?this._positionMarker=L.marker([b.Y,b.X]).addTo(this._map):this._positionMarker.setLatLng([b.Y,
b.X]));this._map.setView([b.Y,b.X],this.options.zoomLevel,!1);this._map.fireEvent("geosearch_showlocation",{Location:b});return this._cancelSearch()};a.prototype._isShowingError=!1;a.prototype._printError=function(b){this._message.innerHTML=b;L.DomUtil.removeClass(this._message,"displayNone");this._changeIcon("alert");this._isShowingError=!0;return this._hideAutocomplete()};a.prototype._cancelSearch=function(){this._container.querySelector("input").value="";this._changeIcon("glass");return this._hide()};
a.prototype._startSearch=function(){var b;this._changeIcon("spinner");b=this._container.querySelector("input");this.options.provider.GetLocations(b.value,this._showLocation);return this._hide()};a.prototype._recordLastUserInput=function(b){return this._lastUserInput=b};a.prototype._show=function(b){var a,c;this._changeIcon("glass");this._suggestionBox.innerHTML="";this._suggestionBox.currentSelection=-1;for(a=0;a<b.length&&a<this.options.maxResultCount;)c=this._newSuggestion(b[a]),this._suggestionBox.appendChild(c),
++a;0<a?L.DomUtil.removeClass(this._suggestionBox,"displayNone"):this._hide();return a};a.prototype._hideAutocomplete=function(){L.DomUtil.hasClass(this._suggestionBox,"displayNone")||L.DomUtil.addClass(this._suggestionBox,"displayNone");return clearTimeout(this._autocompleteRequestTimer)};a.prototype._hide=function(){var b;this.options.enableAutocomplete&&this._hideAutocomplete;b=this._container.querySelector("form");L.DomUtil.hasClass(b,"displayNone")||this.options.open||L.DomUtil.addClass(b,"displayNone");
L.DomUtil.hasClass(this._message,"displayNone")||L.DomUtil.addClass(this._message,"displayNone");return this._suggestionBox.innerHTML=""};a.prototype._isVisible=function(){return!L.DomUtil.hasClass(this._suggestionBox,"displayNone")};a.prototype._htmlEscape=function(b){return String(b).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")};a.prototype._newSuggestion=function(b){var a,c=this;a=L.DomUtil.create("li","leaflet-geosearch-suggestion");
a.innerHTML='<i class="leaflet-control-geosearch marker"></i>'+this.options.onMakeSuggestionHTML(b);a._text=b.Label;L.DomEvent.disableClickPropagation(a).on(a,"click",function(b){c._onSelection(a._text);return c._startSearch()});return a};a.prototype._onSelection=function(b){return this._searchInput.value=b};a.prototype._onSelectedUpdate=function(){var b,a;b=this._suggestionBox.hasChildNodes()?this._suggestionBox.childNodes:[];for(a=0;a<b.length;)L.DomUtil.removeClass(b[a],"leaflet-geosearch-suggestion-selected"),
++a;return 0<=this._suggestionBox.currentSelection?(L.DomUtil.addClass(b[this._suggestionBox.currentSelection],"leaflet-geosearch-suggestion-selected"),a=b[this._suggestionBox.currentSelection].offsetTop,a+b[this._suggestionBox.currentSelection].clientHeight>=this._suggestionBox.scrollTop+this._suggestionBox.clientHeight?this._suggestionBox.scrollTop=a-this._suggestionBox.clientHeight+b[this._suggestionBox.currentSelection].clientHeight:a<=this._suggestionBox.scrollTop&&(this._suggestionBox.scrollTop=
a),this._onSelection(b[this._suggestionBox.currentSelection]._text)):this._onSelection(this._lastUserInput)};a.prototype._moveUp=function(){if(this._isVisible()&&0<=this._suggestionBox.currentSelection)return--this._suggestionBox.currentSelection,this._onSelectedUpdate()};a.prototype._moveDown=function(){if(this._isVisible())return this._suggestionBox.currentSelection=(this._suggestionBox.currentSelection+1)%this._suggestionCount(),this._onSelectedUpdate()};a.prototype._suggestionCount=function(){return this._suggestionBox.hasChildNodes()?
this._suggestionBox.childNodes.length:0};a.prototype._onInput=function(){if(this._isShowingError)return this._changeIcon("glass"),L.DomUtil.addClass(this._message,"displayNone"),this._isShowingError=!1};a.prototype._clearUserSearchInput=function(){this._searchInput.value="";return this._hideAutocomplete()};a.prototype._onChange=function(){var a;if(this.options.enableAutocomplete){a=this._container.querySelector("input");a=a.value;this._recordLastUserInput(a);if(a.length>=this.options.autocompleteMinQueryLen)return this._changeIcon("spinner"),
this._geosearchAutocomplete(a,this.options.autocompleteQueryDelay_ms);this._changeIcon("glass");return this._hideAutocomplete()}};a.prototype._onKeyPress=function(a){switch(a.keyCode){case 13:return L.DomEvent.preventDefault(a),this._startSearch()}};a.prototype._onKeyUp=function(a){switch(a.keyCode){case 38:if(this.options.enableAutocomplete&&this._isVisible())return this._moveUp();break;case 40:if(this.options.enableAutocomplete&&this._isVisible())return this._moveDown();break;case 27:this._container.querySelector("input");
if(this._isVisible())return this._hideAutocomplete();a=this._container.querySelector("form");L.DomUtil.hasClass(a,"displayNone")||L.DomUtil.addClass(a,"displayNone");this._onInput();return this._hide();default:return this._onChange()}};return a}(L.Control)}).call(this);
